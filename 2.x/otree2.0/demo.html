<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>OTREE示例</title>
	<meta name="description" content="" />
    <meta name="keywords" content="" />
	<style type="text/css">
	body{font-size:12px;}
	</style>
	<style type="text/css">
		.form a{margin-right:5px;}
	</style>
	<script type="text/javascript" src="otree.js"></script>
</head>
<body>

<div id="treebox" style="width:240px; height:360px; overflow:auto; padding:5px 0; border:solid 1px #ddd;float:left;"></div>
<div id="treebox1" style="width:150px; height:360px; overflow:auto; padding:5px 0; border:solid 1px #ddd;float:left;margin-left:10px;"></div>
<div id="treebox2" style="width:200px; height:360px; overflow:auto; padding:0; border:solid 1px #ddd;float:left;margin-left:10px;">
	<ul id="lstUnit">
		<li><a lang="{id:1,pid:-1,level:0,name:'各大网站导航',checkbox:{name:'chbUnit'}}" class="current" href="javascript:void(0);" target="frmMain">网站导航</a></li>
		<li><a lang="{id:3,pid:1,level:1,checkbox:{id:mid, name:'chbUnit', value:'val1'}}" href="http://www.google.com" target="frmMain">谷歌</a></li>
		<li><a lang="{id:4,pid:2,level:2,checkbox:{id:mid, name:'chbUnit', value:'val2'}}" href="http://map.baidu.com"  target="frmMain">百度地图</a></li>
		<li><a lang="{id:6,pid:2,level:2,checkbox:{name:'chbUnit'}}" href="http://music.baidu.com"  target="frmMain">百度音乐</a></li>
		<li><a lang="{id:2,pid:1,level:1,checkbox:{name:'chbUnit'}}" href="http://www.baidu.com" target="frmMain">百度</a></li>
		<li><a lang="{id:8,pid:5,level:2,checkbox:{name:'chbUnit'}}" href="http://www.126.com" target="frmMain">126邮箱</a></li>
		<li><a lang="{id:5,pid:1,level:1,checkbox:{name:'chbUnit'}}" href="http://www.163.com" target="frmMain">网易</a></li>
		<li><a lang="{id:10,pid:1,level:1,checkbox:{name:'chbUnit'}}" href="http://www.alibaba.com" target="frmMain">阿里巴巴</a></li>
		<li><a lang="{id:11,pid:10,level:1,checkbox:{name:'chbUnit'}}" href="http://www.taobao.com" target="frmMain">淘宝</a></li>
		<li><a lang="{id:12,pid:10,level:1,checkbox:{name:'chbUnit'}}" href="https://www.alipay.com" target="frmMain">支付宝</a></li>
		<li><a lang="{id:13,pid:10,level:1,checkbox:{name:'chbUnit'}}" href="http://www.aliyun.com" target="frmMain">阿里云</a></li>
		<li><a lang="{id:20,pid:1,level:1,checkbox:{name:'chbUnit'}}" href="http://www.sina.com" target="frmMain">新浪</a></li>
		<li><a lang="{id:21,pid:4,level:3,checkbox:{name:'chbUnit'}}" href="http://map.baidu.com"  target="frmMain">百度地图API</a></li>
		<li><a lang="{id:22,pid:4,level:3,checkbox:{name:'chbUnit'}}" href="http://map.baidu.com"  target="frmMain">百度地图接口</a></li>
		<li><a lang="{id:23,pid:21,level:4,checkbox:{name:'chbUnit'}}" href="http://map.baidu.com"  target="frmMain">百度地图API-1</a></li>
		<li><a lang="{id:24,pid:23,level:5,checkbox:{name:'chbUnit'}}" href="http://map.baidu.com"  target="frmMain">百度地图API-1-1</a></li>
	</ul>
	<div style="background:#ddd;margin-bottom:5px;">读取HTML中的li列表<br /> 自动生成树菜单：</div>
</div>
<div style="margin-left:10px;float:left;width:400px;">
	<textarea id="txtHtml" style="width:400px;height:50px;"></textarea>
	<textarea id="txtDebug" style="width:400px;height:40px;"></textarea>
	iframe:
	<iframe id="frmMain" name="frmMain" style="width:605px;height:245px;"></iframe>
</div>
<br />
<div id="divDebug" style="clear:both;"></div>
<div class="form" style="clear:both;padding-top:10px;">
<table cellpadding="5" cellspacing="0">
	<tr>
		<td>节点ID:</td>
		<td><input type="text" id="txtNodeId" style="width:30px;" value="16" /></td>
		<td>
			<a onclick="addTreeNode();" onfocus="this.blur();" href="javascript:void(0);">添加子节点</a>
			<a onclick="delSubNode();" onfocus="this.blur();" href="javascript:void(0);">删除子节点</a>
			<a onclick="delNode();" onfocus="this.blur();" href="javascript:void(0);">删除节点</a>

			<a onclick="switchNode(true);" onfocus="this.blur();" href="javascript:void(0);">打开节点</a>
			<a onclick="switchNode(false);" onfocus="this.blur();" href="javascript:void(0);">关闭节点</a>
			<a onclick="showNode(true);" onfocus="this.blur();" href="javascript:void(0);">显示节点</a>
			<a onclick="showNode(false);" onfocus="this.blur();" href="javascript:void(0);">隐藏节点</a>
			
			<a onclick="moveNode(true);" onfocus="this.blur();" href="javascript:void(0);">向上移动节点位置</a>
			<a onclick="moveNode(false);" onfocus="this.blur();" href="javascript:void(0);">向下移动节点位置</a>
		</td>
	</tr>
	<tr>
		<td>节点数量：</td>
		<td><input type="text" id="txtNodeCount" style="width:30px;" value="10" />个</td>
		<td>
			<a onclick="selectCheckBox(true);" onfocus="this.blur();" href="javascript:void(0);">选中当前节点复选框</a>
			<a onclick="selectCheckBox(false);" onfocus="this.blur();" href="javascript:void(0);">取消选中当前节点复选框</a>
			<a onclick="selectCheckBox1(true);" onfocus="this.blur();" href="javascript:void(0);">选中当前节点复选框(被禁用的)</a>
			<a onclick="selectCheckBox1(false);" onfocus="this.blur();" href="javascript:void(0);">取消选中当前节点复选框(被禁用的)</a>
		</td>
	</tr>
	<tr>
		<td></td>
		<td></td>
		<td>
			<a onclick="openAll();" onfocus="this.blur();" href="javascript:void(0);">打开所有</a>
			<a onclick="closeAll();" onfocus="this.blur();" href="javascript:void(0);">关闭所有</a>
			<a onclick="showTree(true);" onfocus="this.blur();" href="javascript:void(0);">显示树菜单</a>
			<a onclick="showTree(false);" onfocus="this.blur();" href="javascript:void(0);">隐藏树菜单</a>
			<a onclick="selectAllCheckBox(true);" onfocus="this.blur();" href="javascript:void(0);">选中所有复选框</a>
			<a onclick="selectAllCheckBox(false);" onfocus="this.blur();" href="javascript:void(0);">取消选中所有复选框</a>
		</td>
	</tr>
	<tr>
		<td>Level:</td>
		<td><input type="text" id="txtLevel" style="width:30px;" value="1" /></td>
		<td>
			<a onclick="openLevel();" onfocus="this.blur();" href="javascript:void(0);">打开Level</a>
		</td>
	</tr>
	<tr>
		<td>Type:</td>
		<td><input type="text" id="txtType" style="width:50px;" value="unit" /></td>
		<td>
			<a onclick="openType();" onfocus="this.blur();" href="javascript:void(0);">打开节点类型</a>
			<a onclick="closeType();" onfocus="this.blur();" href="javascript:void(0);">关闭节点类型</a>
		</td>
	</tr>
	<tr>
		<td></td>
		<td></td>
		<td>
			<a onclick="getSelected();" onfocus="this.blur();" href="javascript:void(0);">获取当前选择的内容</a>
		</td>
	</tr>
	<tr>
		<td></td>
		<td></td>
		<td>
			<a onclick="showLine();" onfocus="this.blur();" href="javascript:void(0);">显示连线</a>
			<a onclick="hideLine();" onfocus="this.blur();" href="javascript:void(0);">隐藏连线</a>
		</td>
	</tr>
	<tr>
		<td>Checkbox Name:</td>
		<td>
			<select id="ddlChbName">
				<option value=""></option>
				<option value="chbUnit">chbUnit</option>
				<option value="chbDevice">chbDevice</option>
				<option value="chbChannel">chbChannel</option>
				<option value="chbGroup">chbGroup</option>
			</select>
		</td>
		<td>
			<a onclick="getChecked();" onfocus="this.blur();" href="javascript:void(0);">获得选中的复选框</a>
			<a onclick="getCheckedValue();" onfocus="this.blur();" href="javascript:void(0);">获得选中的复选框内容</a>
		</td>
	</tr>
</table>
</div>
</body>
</html>
<script type="text/javascript">

String.prototype.padLeft = function(totalWidth, paddingChar) {
    var s = this;
    if (paddingChar == undefined) {
        paddingChar = '0';
    }
    for (var i = 0, c = totalWidth - s.length; i < c; i++) {
        s = paddingChar + s;
    }
    return s;
};
Date.prototype.toString = function (format) {
    var year = this.getFullYear();
    if (year < 1900) { year += 1900; }
    var strDate = ['' + year,
        ('' + (this.getMonth() + 1)).padLeft(2, '0'), 
        ('' + this.getDate()).padLeft(2, '0'), 
        ('' + this.getHours()).padLeft(2, '0'), 
        ('' + this.getMinutes()).padLeft(2, '0'), 
        ('' + this.getSeconds()).padLeft(2, '0'),  
        ('' + this.getMilliseconds()).padLeft(3, '0')
    ];
    return strDate[0] + '-' + strDate[1] + '-' + strDate[2] + ' ' + strDate[3] + ':' + strDate[4] + ':' + strDate[5] + ' ' + strDate[6];
};
	function $I(i){
		return document.getElementById(i);
	}

	function expandCallBack(param){
		//alert('expandCallBack:' + param.id + ',' + param.type + ',' + param.code);
	}

	function callBack(param, objTree, callbackObj){
		document.getElementById('divDebug').innerHTML = param.id + ',' + param.name;
		//alert('CallBack:{id:' + param.id + ',pid:' + param.pid + ',type:' + param.type + ',code:' + param.code + ',name:' + param.name + ',level:' + param.level + ',loaded:' + param.loaded + ',tree:' + param.tree + '}');//param.tree 一维数组 [pid,pid,...,id]
		if(param.tree != undefined && objTree != undefined){
			if(param.id == 15 || param.id == 16){
				alert('父级树：' + objTree.getTextValue(param.tree));
			}
		}
		//alert(typeof param.id + ',' + param.id);
	}	

	function callBack1(param){
		//alert('CallBack-1:{id:' + param.id + ',pid:' + param.pid + ',type:' + param.type + ',code:' + param.code + ',name:' + param.name + ',level:' + param.level + ',tree:' + param.tree + '}');
	}

	function loadedCallback(objTree){
		
		//objTree.openLevel(0);
		if(1 == objTree.loadTimes){
			//objTree.root({id:'root1', name:'树菜单1'});
		}
		//alert('树菜单节点加载完毕' + ', 第' + objTree.loadTimes + '次');
	}

	function ContextMenuCallBack(param){
		alert(param);
	}

	function selectCheckBoxCallBack(param){
		alert(param + ',' + param.id + ',' + param.chbName + ',value:' + param.value);
		var arr = document.getElementsByName('chbDevice');

		//alert(arr.length);
	}

	
	function moveNode(action){
		var nid = $I('txtNodeId').value;
		//移动节点，即节点动态排序功能，（注：节点移动功能仅限于不显示线条的情况下，显示线条的情况下会出现线条错位的情况）
		//4个参数
		//nid: 要移动的节点，
		//action: true|'up' 向上，false|'down' 向下
		//tnid: 目标节点
		//moveNodeCallback: 回调函数，移动后回调
		o.move(nid, action, null, moveNodeCallback);
	}

	//isMove 是否移动成功，true:成功，false:失败
	//arr 移动的节点，节点1 的数据
	//action 移动方式 向上或向下
	function moveNodeCallback(isMove, arr, action){
		alert('移动' + (isMove ? '成功':'失败(可能到顶或到底了)'));
		if(isMove){
			alert(arr[0].id + ',' + arr[1].id + ', ' + action);
		}
	}
	
	function stopBubble(ev){
		try{
			ev = window.event || e;
			if(ev.stopPropagation){ev.stopPropagation();} else{ev.cancelBubble = true;}
			if(ev.preventDefault){ev.preventDefault();} else{ev.returnValue = false;}
		}catch(ex){}
	}

	function treeContextMenu(e, obj, param, objTree){
		alert('调用自定义右键菜单（右键菜单自行处理）：' + param.id + ',' + obj.innerHTML);
		return false;
		var config = {
			//width: 150, //宽度可以设置，也可以不设置
			zindex: 1000,
			opacity: 1,
			item: [
				{text: obj.innerHTML,func:function(){ ContextMenuCallBack(obj.innerHTML); } },
				{text:'新建新建',shortcutkey:'N', func:function(){ ContextMenuCallBack('新建'); } },
				{text:'编辑编辑1',shortcutkey:'E', func:function(){ ContextMenuCallBack('编辑'); },
					sub:{
						//width: 120, //宽度可以设置，也可以不设置
						item:[
							{text:'更新', shortcutkey:'U', func:function(){ ContextMenuCallBack('更新'); }},
							{text:'删除aa', disabled:true, func:function(){ ContextMenuCallBack('删除'); }},
							{text: 'separator'},
							{text:'复制', shortcutkey:'C', func:function(){ ContextMenuCallBack('复制'); }},
							{text:'粘贴', func:function(){ ContextMenuCallBack('粘贴'); }},
							{text:'剪切', func:function(){ ContextMenuCallBack('剪切'); }}
						]
					}
				},
				{text:'保存保存',func:function(){ } }
			]
		};
		new ContextMenu(e, config, obj);
	}

	var o = new oTree('o', $I('treebox'), {
		showCheckBox: true, showSubNode: true,
		showIcon: true, 
		showLine: false,
		showContextMenu: true,
		spaceWidth: 15, skin: 'default',
		callback: callBack,
		complete: loadedCallback,
		//loadedCallback: loadedCallback,
		//showFocus: false,
		showTitle: true,
		expandCallback: expandCallBack, 
		checkboxCallback: selectCheckBoxCallBack,
		dblclick: false,
		keyEvent: true, //是否启用键盘(上、下键)事件
		idIsNumber: true
	});
	var mid = 1;

	//o.root({id:'root0', name:'树菜单根节点0'});

	o.add({id:1, name:'树菜单根节点1', isRoot:true,callback:function(){alert('root1');}});
	o.add({id:2, name:'树菜单根节点2', isRoot:true,callback:function(){}});

	mid = 3;
	o.add({
		id:mid, pid:1, name:'第' + mid + '个节点',type:'unit',
		checkbox:{name:'chbUnit', callback: function(param){selectCheckBoxCallBack(param);}}
	});
	
	mid++;

	o.add({id:mid, pid:1, name:'第' + mid + '个节点',type:'unit',param:{id:99999},checkbox:{id:mid, name:'chbUnit', value:mid, callback: selectCheckBoxCallBack}});
	
	$I('txtHtml').value = '';

	for(var i=0; i<5; i++){
		mid++;
		o.add({
			id:mid, pid:3, name:'第' + mid + '个节点\'sac\"a',type:'unit',code:'code-' + mid,icon:'folder.gif',
			//href:'http://60.12.220.24:81',target:'frmMain',
			callback:function(param){callBack(param);},
			//clickToggle:'toggle', //open|close|toggle
			clickChecked:null,
			showSwitch: false,
			contextmenu: function(event, obj, param){treeContextMenu(event, obj, param);},
			//contextmenu: treeContextMenu,
			checkbox:{
				id:mid, name:'chbUnit', value:'val' + mid, callback: function(param){selectCheckBoxCallBack(param);}
			}
		});
	}
	for(var i=0; i<5; i++){
		mid++;
		o.add({
			id:mid, pid:3, name:'新增的节点' + (mid),type:'unit',callback:'callBack1',clickChecked:true,
			checkbox:{id:mid, name:'chbUnit', value:'val' + mid, callback: selectCheckBoxCallBack}
		});
	}
	
	function loadData(){
		$I('txtDebug').value = new Date().toString('yyyy-MM-dd HH:mm:ss fff') + '\r\n';
		
		var c = 6;
		for(var i=0; i<c; i++){
			mid++;
			o.add({
				id:mid, pid:8, name:'新增的子节点' + (mid),type:'device', icon:'page.gif',callback:callBack,
				checkbox:{id:mid, name:'chbDevice', value:mid, callback: selectCheckBoxCallBack}
			});
		}
		for(var i=0; i<c; i++){
			mid++;
			o.add({
				id:mid, pid:9, name:'新增的子节点' + (mid),type:'device', icon:'page.gif',callback:callBack,
				checkbox:{id:mid, name:'chbDevice', value:mid, callback: selectCheckBoxCallBack}
			});
		}
		
		for(var i=0; i<c; i++){
			mid++;
			o.add({
				id:mid, pid:20, name:'新增的子节点' + (mid),type:'channel', icon:'page.gif',callback:callBack,
				checkbox:{id:mid, name:'chbChannel', value:mid, callback: selectCheckBoxCallBack}
			});
		}

		for(var i=0; i<c; i++){
			mid++;
			o.add({
				id:mid, pid:21, name:'新增的子节点' + (mid),type:'channel', icon:'page.gif',callback:callBack,
				checkbox:{id:mid, name:'chbChannel', value:mid, callback: selectCheckBoxCallBack}
			});
		}
		o.add({id:'group', pid:2, name:'我的分组', type:'group',callback:callBack,
			checkbox:{id:mid, name:'chbGroup', value:mid, callback: selectCheckBoxCallBack}
		});

		for(var i=0; i<5; i++){
			mid++;
			o.add({
				id:mid, pid:'group', name:'分组子节点' + mid,code:'1001',count:10,type:'device', icon:'page.gif',
				callback:callBack,
				checkbox:{id:mid, name:'chbDevice', value:mid, disabled:true, callback: selectCheckBoxCallBack}
			});
		}
		
		var pid = mid-1;
		
		for(var i=0; i<5; i++){
			mid++;
			o.add({
				id:mid, pid:pid, name:'分组子节点' + mid,code:'1001',count:10,type:'device', icon:'page.gif',
				callback:callBack,
				checkbox:{id:mid, name:'chbDevice', value:mid, callback: selectCheckBoxCallBack}
			});
		}
		
		
		$I('txtDebug').value += new Date().toString('yyyy-MM-dd HH:mm:ss fff') + '\r\n';
	}

	//window.setTimeout(loadData, 1000);

	loadData();
	
	function addTreeNode(){
		$I('txtDebug').value += new Date().toString('yyyy-MM-dd HH:mm:ss fff') + '\r\n';
		var pid = $I('txtNodeId').value;
		var count = parseInt($I('txtNodeCount').value,10);
		if(isNaN(count)){
			count = 10;
		}
		for(var i=0; i<count; i++){
			mid++;
			//o.add({id:mid, pid:pid, append:false, name:'新增的节点' + (mid),icon:'imgs/device/device.gif',checkbox:{id:mid, name:'chbDevice', value:mid, callBack: selectCheckBoxCallBack}});
			o.add({id:mid, pid:pid, append:false, name:'新增的节点' + (mid),checkbox:{id:mid, name:'chbDevice', value:mid, callBack: selectCheckBoxCallBack}});
		}
		$I('txtDebug').value += new Date().toString('yyyy-MM-dd HH:mm:ss fff') + '\r\n';

		
	$I('txtHtml').value = $I('treebox').innerHTML;
	}

	$I('txtHtml').value = $I('treebox').innerHTML;

	o.select(3);


	function delSubNode(){
		var id = $I('txtNodeId').value;
		if(id > 0){
			o.removeChild(id);
		}
	}
	
	function delNode(){
		var id = $I('txtNodeId').value;
		if(id > 0){
			o.removeNode(id);
		}
	}

	function switchNode(isOpen){
		var id = $I('txtNodeId').value;
		if(isOpen){
			o.open(id);
		} else {
			o.close(id);
		}
	}

	function showNode(isShow){
		var id = $I('txtNodeId').value;
		if(id == '') return false;
		if(isShow){
			o.show(id);
		} else {
			o.hide(id);
		}
	}

	function showTree(isShow){
		o.show(null, isShow);
	}


	function openAll(){
		o.openAll();	
	}

	function closeAll(){
		o.closeAll();
	}

	function openLevel(){
		var level = parseInt($I('txtLevel').value, 10);
		o.openLevel(level);
	}
	//延时更新节点内容
	window.setTimeout(update, 5000);

	function update(){
		o.update({
			id: 10,
			pid: 8,
			name: '更新的节点(ID:' + 10 + ')',
			icon: 'imgfolder.gif'
		});
		
		o.update({
			id:15,
			pid: 8,
			name: '更新的节点(ID:' + 15 + ')',
			//icon: 'imgfolder.gif'
			icon:'imgs/device/device.gif'
		});
		
		o.update({
			id:1,
			pid: -1,
			name: 'OTREE树菜单根节点'
		});
	}
	
	function openType(){
		var type = $I('txtType').value;
		o.openType(type);
	}
	
	function closeType(){
		var type = $I('txtType').value;
		o.closeType(type);
	}

	function showLine(){
		o.showNodeLine();
	}

	function hideLine(){
		o.hideNodeLine();
	}

	function selectCheckBox(isChecked){
		var id = $I('txtNodeId').value;
		o.selectCheckBox(id, isChecked);
	}
	
	function selectCheckBox1(isChecked){
		var id = $I('txtNodeId').value;
		o.selectCheckBox(id, isChecked, null, true);
	}

	function selectAllCheckBox(isChecked){
		o.selectAllCheckBox(isChecked);
	}

	function getChecked(){
		var name = $I('ddlChbName').value;
		var arr = o.getChecked(name);
		alert('选中的复选框数量：' + arr.length);
	}

	function getCheckedValue(){
		var name = $I('ddlChbName').value;
		var arr = o.getCheckedValue(name, false);
		alert('选中的复选框数量：' + arr.length);
		alert('选中的复选框内容列表：' + arr.join(','));
	}

	function getSelected(){
		var param = o.getSelected();

		alert(typeof param);

		alert(param.id + ',' + param.pid + ',' + param.code + ',' + param.name);
	}
	
	var tid = 0;
	var o1 = new oTree('o1', $I('treebox1'), {
		showCheckBox:false,showLine:false,
		keyEvent: true, //是否启用键盘(上、下键)事件
		skin:'device'
	});
	o1.root({name:'设备列表'});
	for(var i=1; i<5; i++){
		tid++;
		o1.add({id:tid, pid:-1, name:'第' + tid + '个节点',callback:callBack});
	}
	for(var i=0; i<5; i++){
		tid++;
		o1.add({id:tid, pid:1, name:'第' + tid + '个节点',callback:callBack});
	}
	for(var i=0; i<5; i++){
		tid++;
		o1.add({id:tid, pid:6, name:'第' + tid + '个节点-设备' + i,icon:'device.gif',callback:callBack});
	}
	
	for(var i=0; i<5; i++){
		tid++;
		o1.add({id:tid, pid:2, show:false, name:'第' + tid + '个节点-设备' + i,icon:'device.gif',callback:callBack});
	}
	//o1.select(6);

	var o2 = new oTree('o2', $I('treebox2'), {
		showCheckBox:true,showSubNode:true,showIcon:true,
		keyEvent: true, //是否启用键盘(上、下键)事件
		showLine:true,
		callback: function(param){alert(param.name);},
		checkboxCallback: selectCheckBoxCallBack
	});

	function getList(){
		//o2.htmlToTree({obj:$I('lstUnit'),isSort:true, childTagName:'A'});
		o2.htmlToTree({obj:$I('lstUnit'),isSort:true});

		 //window.setTimeout(function(){alert(o2.box.innerHTML)}, 3000);
	}
	getList();

</script>